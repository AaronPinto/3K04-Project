\documentclass[12pt]{article}

\usepackage[letterpaper, margin=1in]{geometry}
\usepackage{titling} \predate{} \postdate{}
\usepackage{parskip}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{pifont}
\usepackage{tikz}
\usepackage{hyperref}
\usepackage{listings}

\usetikzlibrary{calc}
\newcommand{\cmark}{\ding{51}}
\long\def\/*#1*/{}
\usepackage{booktabs}
\newcommand{\tikzmark}[1]{\tikz[overlay,remember picture] \node (#1) {};}
\newcommand{\DrawBox}[3][]{%
    \tikz[overlay,remember picture]{
    \draw[black,#1]
      ($(#2)+(-0.65em,2.3ex)$) rectangle
      ($(#3)+(0.65em,-1.2ex)$);}
}

\title{SFWRENG 3K04 \\ Assignment 1 Part 2 \\ Documentation}
\author{
    Lab 1 Group 7 \\
    Carlos Capili \\
    Raeed Hassan \\
    Shaqeeb Momen \\
    Aaron Pinto \\
    Udeep Shah
}
\date{}

\setlength{\aboverulesep}{0pt}
\setlength{\belowrulesep}{0pt}

\usepackage{titlesec}

\setcounter{secnumdepth}{4}
\setcounter{tocdepth}{4}

\titleformat{\paragraph}
{\normalfont\normalsize\bfseries}{\theparagraph}{1em}{}
\titlespacing*{\paragraph}
{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

\begin{document}
\maketitle \newpage
\tableofcontents \newpage

\section{Requirements}

\subsection{Welcome Screen}
%Develop an interface that includes a welcome screen, including the ability to register a new user (name and password), and to login as an existing user. A maximum of 10 users should be allowed to be stored locally.
All required aspects of the welcome screen are implemented in the current software revision: 
\begin{itemize}
    \item Register a new user
    \item Login as an existing user
    \item Maximum of 10 users stored locally
\end{itemize}
All requirements will remain in future software revisions.  

\subsection{User Interface Essential Aspects}
All required essential aspects of the user interface have been implemented in the current software revision:
\begin{itemize}
    \item User interface is capable of utilizing and managing windows for display of text and graphics
    \item User interface is capable of processing user positioning and input buttons
    \item User interface is capable of displaying all programmable parameters for review and modification
    \item User interface is capable of visually indicating when the DCM and the device are communicating
    \item User interface is capable of visually indicating when a different PACEMAKER device is approached than was previously interrogated
\end{itemize}
All requirements will remain in future software revisions.

\subsection{DCM Utility Functions}
\subsubsection{About}
All required aspects of the About function are implemented in the current software revision: 
\begin{itemize}
    \item Application model number
    \item Application software revision
    \item DCM serial number
    \item Institution name
\end{itemize}
All requirements will remain in future software revisions.

\subsubsection{Set Clock}
The Set Clock function is not implemented, but has been allocated a window and a button on the DCM main window. This function will likely be removed in a future revision of the software depending on the feasibility of implementing the feature.

\subsubsection{New Patient}
The New Patient function is implemented in the current software revision. The function will remain in future software revisions.

\subsubsection{Quit}
The Quit function is implemented in the current software revision. The function will remain in future software revisions.

\subsection{Pacing Mode Interfaces}
Interfaces for pacing modes and pacing mode selection for the following pacing modes are implemented in the current software revision:
\begin{itemize}
    \item AOO
    \item AAI
    \item VOO
    \item VVI
\end{itemize} 
Additional pacing modes will be added to the requirements and implemented in future software revisions including:
\begin{itemize}
    \item DOO
    \item AOOR
    \item VOOR
    \item AAIR
    \item VVIR
    \item DOOR
\end{itemize}

\subsection{Printed Reports}
All common requirements for printed reports are implemented in the current software revision:
\begin{itemize}
    \item Header Information
    \begin{itemize}
        \item Application model and version number
        \item Device model and serial number
        \item DCM serial number
        \item Date and time of report printing
        \item Report name 
    \end{itemize}
\end{itemize}
All common requirements for printed reports will remain in future software revisions.
\subsubsection{Bradycardia Parameters}
The feature is implemented in the current software revision. The feature will remain in future software revisions.
\subsubsection{Temporary Parameters}
The feature has been allocated a button in the reports window in the current software revision. This feature will likely be removed in a future revision of the software as it is unlikely that a temporary pacing mode is introduced.

\subsection{Programmable Parameters}
Provisions for storing programmable parameter data have been implemented in the current software revision for the following programmable paramters:
\begin{itemize}
    \item Lower Rate Limit
    \item Upper Rate Limit
    \item Atrial Amplitude
    \item Atrial Pulse Width
    \item Atrial Refractory Period (ARP)
    \item Ventricular Amplitude
    \item Ventricular Pulse Width
    \item Ventricular Refractory Period (VRP)
\end{itemize}
These programmable parameters will remain in future software revisions. Additional programmable parameters will be implemented in future software revisions which will depend on future requirements. 

\subsection{Real-time Electrograms}
The following requirements of real-time electrograms and the displaying of electrograms have been implemented in the current software revision:
\begin{itemize}
    \item Real-time internal electrograms shall be made available from atrial and ventricular sense/pace leads
    \item Electrogram viewing
    \begin{itemize}
        \item The user shall have the option of viewing electrograms on the screen
        \item The user shall have the option of selecting which electrograms are viewed
    \end{itemize}
    \item The system is capable of displaying real-time traces in a scrollable fashion
\end{itemize}
These features will remain in future software revisions. 

Requirements that will be implemented in future software revisions include:
\begin{itemize}
    \item The DCM shall be capable of printing real time telemetered data
    \begin{itemize}
        \item will be implemented after serial communication with pacemaker for telemetry has been implemented
    \end{itemize}
\end{itemize}

Requirements that involve the surface ECG will not be implemented in future requirements due to the lack of a surface ECG on the pacemaker.

\subsection{Future Requirements}
Future requirements that will be implemented include:
\begin{itemize}
    \item Serial communication between DCM and Pacemaker
    \begin{itemize}
        \item Sending programmable parameters to Pacemaker
        \item Receiving telemetry data from Pacemaker
    \end{itemize}
    \item Input validation for safety critical Pacemaker systems operated by DCM
\end{itemize}

\newpage
\section{Software}
\subsection{General Design Decisions}
The DCM and all its modules were programmed in Python 3. The decision to use Python was largely due to the programmers' familiarity with the Python language and Python libraries that could be used to handle different DCM systems. The release of Python decided was \href{https://www.python.org/downloads/release/python-379/}{Python 3.7.9}; an earlier release was selected to ensure compatibility with potential libraries.

The GUI was designed using \href{https://riverbankcomputing.com/software/pyqt/intro}{PyQt}, a Python library for \href{https://www.qt.io/}{Qt}, a widget-toolkit for designing and creating graphical user interfaces. It was initially decided that Python's standard \href{https://docs.python.org/3/library/tkinter.html}{Tkinter} package and it's associated tools would be used, however it was later decided that a tool that would allow us to create our user interface graphically instead of programmatically would ease our workflow. The \href{https://pypi.org/project/PyQt5/}{PyQt5} library was ultimately decided upon due to the ability to automatically generate the code for the graphical user interface from design files created using \href{https://doc.qt.io/qt-5/qtdesigner-manual.html}{Qt Designer}, a tool to graphically design GUI elements for Qt.

Serial communcation between the DCM and Pacemaker and device recognition is handled by the \href{https://pypi.org/project/pyserial/}{pyserial} library due to the programmers' familiarity with the library.

Graphs in the DCM are handled by the \href{http://www.pyqtgraph.org/}{PyQtGraph} library. The library was chosen due to it's straightforward integration with the PyQt library and it's ability to easily create interactive plots.

\subsection{GUI}
\subsubsection{Welcome Screen}
The welcome window is the window the user is greeted by when the DCM program is launched, allowing the user to register users or login into the DCM. The Welcome Screen is a QStackedWidget, a Qt class that contains multiple widgets but only displays one at a time. The QStackedWidget class was chosen to allow all modules of the welcome screen to be accessible in a single window, while still allowing individual modules to behave independently. Additional modules can easily be added as new widgets without affecting implemented modules. The UI 

\paragraph{Welcome}
The welcome screen is the first widget in the welcome window that is displayed when the window is launched. The widget gives the user the option to register a new user or login as an existing user through push buttons displayed in the widget. The welcome widget is a QWidget with internal functions that cannot be accessed by the other widgets. The widget's only functions are to direct the user to another widget when a push button is pressed. The register button will lead the user to the register widget and the login button will lead the user to the login widget. A tabular expression detailing the expected behaviour of the widget's functions are shown in Table \ref{tab:DCM_Welcome}.
\begin{table}[ht]
\centering
\setlength{\aboverulesep}{0pt}
\setlength{\belowrulesep}{0pt}
\begin{tabular}{cc} \cmidrule{2-2}
    Push Button & \multicolumn{1}{|c|}{\tikzmark{topleft}\hfill Function\hfill\null} \\ \hline
    \multicolumn{1}{|c}{welcome\_ui.reg\_btn} & \multicolumn{1}{|c|}{welcome\_gui.setCurrentIndex(1)} \\ \hline
    \multicolumn{1}{|c}{welcome\_ui.log\_btn} & \multicolumn{1}{|c|}{welcome\_gui.setCurrentIndex(2)\hfill\null\tikzmark{bottomright}}  \\ \cmidrule{1-2}
\end{tabular}
\caption{\label{tab:DCM_Welcome}Welcome Screen}
\DrawBox[thin, black]{topleft}{bottomright}
\end{table}

\paragraph{Register}
The register screen can only be navigated to from the welcome screen. The register screens gives the user the ability to register a new user using a username and password, or return to the welcome screen. The register widget is a QWidget with internal functions that cannot be accessed by the other widgets. The widget's functions are accepting user inputs in the username and password fields, authorizing the user inputs, or directing the user to another widget. The register button will call the authentication handler's register funnction with the text in the username and password fields as inputs. The back button will return the user to the welcome screen. A tabular expression detailing the expected behaviour of the widget's functions are shown in Table \ref{tab:DCM_Register}.
\begin{table}[ht]
    \centering
    \setlength{\aboverulesep}{0pt}
    \setlength{\belowrulesep}{0pt}
    \begin{tabular}{cc} \cmidrule{2-2}
        Push Button & \multicolumn{1}{|c|}{\tikzmark{topleft}\hfill Function\hfill\null} \\ \hline
        \multicolumn{1}{|c}{welcome\_ui.reg\_back\_btn} & \multicolumn{1}{|c|}{welcome\_gui.setCurrentIndex(0)} \\ \hline
        \multicolumn{1}{|c}{welcome\_ui.reg\_submit\_btn} & \multicolumn{1}{|c|}{\hfill auth.register\hfill\null\tikzmark{bottomright}}  \\ \cmidrule{1-2}
    \end{tabular}
    \caption{\label{tab:DCM_Register}Register}
    \DrawBox[thin, black]{topleft}{bottomright}
    \end{table}

\paragraph{Login}
The login screen can only be navigated to from the welcome screen. The login screens gives the user the ability to login as an existing user using a username and password, or return to the welcome screen. The login widget is a QWidget with internal functions that cannot be accessed by the other widgets. The widget's functions are accepting user inputs in the username and password fields, authorizing the user inputs, or directing the user to another widget. The login button will call the authentication handler's login funnction with the text in the username and password fields as inputs. The back button will return the user to the welcome screen. A tabular expression detailing the expected behaviour of the widget's functions are shown in Table \ref{tab:DCM_Login}.
\begin{table}[ht]
    \centering
    \setlength{\aboverulesep}{0pt}
    \setlength{\belowrulesep}{0pt}
    \begin{tabular}{cc} \cmidrule{2-2}
        Push Button & \multicolumn{1}{|c|}{\tikzmark{topleft}\hfill Function\hfill\null} \\ \hline
        \multicolumn{1}{|c}{welcome\_ui.log\_back\_btn} & \multicolumn{1}{|c|}{welcome\_gui.setCurrentIndex(0)} \\ \hline
        \multicolumn{1}{|c}{welcome\_ui.log\_submit\_btn} & \multicolumn{1}{|c|}{\hfill auth.login\hfill\null\tikzmark{bottomright}}  \\ \cmidrule{1-2}
    \end{tabular}
    \caption{\label{tab:DCM_Login}Login}
    \DrawBox[thin, black]{topleft}{bottomright}
    \end{table}

\subsubsection{DCM Main Window}
The main window is the window which contains all the DCM functions. The main window has three main functions: presenting important information about the pacemaker (DCM's connection status with the pacemaker, the pacemaker's pacing mode, graphical telemetry data from the pacemaker), provides the user the ability to change pacing modes, and allows the user to access the DCM's functions. The main window is a QMainWindow, a Qt class intended for main window management. The class was chosen due to it's ability to add status bars, which will be used to display information about the DCM's connection with the pacemaker. The main window consists of three main sections: real-time electrograms, pacing mode interfaces, and DCM functions. While there are some interactions between these sections (particularly the pacing mode interfaces and the modules in the DCM functions), they are largely contained in their own modules that can function independently from each other. Future modules can be added to any section without affecting implemented modules (with the expection of modules that do not have any defined behaviour for additional pacing modes).

The real-time electrograms show real-time telemetry data from the pace and sense leads on the pacemaker. Checkboxes for pace/sense leads will show and hide the pace/sense plots. The expected behaviour of the checkboxes are shown in Table \ref{tab:DCM_MainWindow}.

The pacing mode interfaces allow the user to select the operating pacing mode of the pacemaker. Pacing mode selection is implemented using the QRadioGroup class, containing instances of the QRadioButton class for each pacing mode. The QRadioGroup class only allows one radio button to be switched on at a time, ensuring only a single pacing mode is selected at all times. Functions in other modules that rely on the pacing mode can rely on the functions of the QRadioGroup class, ensuring that the individual radio buttons cannot be altered.

The DCM's functions are operated through push buttons on the main window. The push buttons will either call a function from a handler (new patient), or direct the user to another window. Relevant handler functions are called in these new windows depending on user selected options presented in these windows. The expected behaviour of the push buttons to access DCM functions are shown in Table \ref{tab:DCM_MainWindow}.

\begin{table}[ht]
    \centering
    \setlength{\aboverulesep}{0pt}
    \setlength{\belowrulesep}{0pt}
    \begin{tabular}{ccc} \cmidrule{3-3}
        \multicolumn{2}{c}{UI Element} & \multicolumn{1}{|c|}{\tikzmark{topleft}\hfill Function\hfill\null}  \\ \hline
        \multicolumn{2}{|c}{dcm\_ui.about\_btn} & \multicolumn{1}{|c|}{about\_gui.exec\_} \\ \hline
        \multicolumn{2}{|c}{dcm\_ui.parameters\_btn} & \multicolumn{1}{|c|}{params\_gui.exec\_} \\ \hline
        \multicolumn{2}{|c}{dcm\_ui.reports\_btn} & \multicolumn{1}{|c|}{reports\_gui.exec\_} \\ \hline 
        \multicolumn{2}{|c}{dcm\_ui.set\_clock\_btn} & \multicolumn{1}{|c|}{set\_clock\_gui.exec\_} \\ \hline 
        \multicolumn{2}{|c}{dcm\_ui.new\_patient\_btn} & \multicolumn{1}{|c|}{conn.register\_device} \\ \hline 
        \multicolumn{2}{|c}{dcm\_ui.quit\_btn} & \multicolumn{1}{|c|}{dcm\_gui.close} \\ \hline
        \multicolumn{1}{|c}{\multirow{2}{*}{dcm\_ui.pace\_box}} & \multicolumn{1}{|c}{isChecked()} & \multicolumn{1}{|c|}{graphs.pace\_show()} \\ \cmidrule{2-3}
        \multicolumn{1}{|c}{} & \multicolumn{1}{|c}{!isChecked()} & \multicolumn{1}{|c|}{graphs.pace\_hide()} \\ \hline
        \multicolumn{1}{|c}{\multirow{2}{*}{dcm\_ui.sense\_box}} & \multicolumn{1}{|c}{isChecked()} & \multicolumn{1}{|c|}{graphs.sense\_show()} \\ \cmidrule{2-3}
        \multicolumn{1}{|c}{} & \multicolumn{1}{|c}{!isChecked()} & \multicolumn{1}{|c|}{graphs.sense\_hide()\hfill\null\tikzmark{bottomright}} \\ \cmidrule{1-3}
    \end{tabular}
    \caption{\label{tab:DCM_MainWindow}DCM Main Window}
    \DrawBox[thin, black]{topleft}{bottomright}
\end{table}
\newpage
\paragraph{Electrograms}
The graphs use the PlotWidget class from PyQtGraph, a QGraphicsWidget with additional functions for plotting. The l

\paragraph{Reports}
\begin{table}[ht]
    \centering
    \setlength{\aboverulesep}{0pt}
    \setlength{\belowrulesep}{0pt}
    \begin{tabular}{cc} \cmidrule{2-2}
        Push Button & \multicolumn{1}{|c|}{\tikzmark{topleft}\hfill Function\hfill\null} \\ \hline
        \multicolumn{1}{|c}{reports\_ui.egram\_btn} & \multicolumn{1}{|c|}{reports.generate\_egram(get\_pace\_mode\_params())} \\ \hline
        \multicolumn{1}{|c}{reports\_ui.brady\_btn} & \multicolumn{1}{|c|}{reports.generate\_brady(get\_pace\_mode\_params())} \\ \hline
        \multicolumn{1}{|c}{reports\_ui.temp\_btn} & \multicolumn{1}{|c|}{reports.generate\_temp(get\_pace\_mode\_params())\hfill\null\tikzmark{bottomright}} \\ \cmidrule{1-2}
    \end{tabular}
    \caption{\label{tab:DCM_Reports}DCM Reports}
    \DrawBox[thin, black]{topleft}{bottomright}
\end{table}
    

\paragraph{Parameters}

\paragraph{About}

\paragraph{New Patient}

\paragraph{Quit}
The Quit push button closes the DCM GUI and exits the program. 

\subsection{Handlers}
\subsubsection{Authentication}
\subsubsection{Connection}
\subsubsection{Graphs}
\subsubsection{Parameters}
\subsubsection{Reports}
\newpage
\section{Testing}
\subsection{GUI}
All testing for the GUI was done manually. Tests for all modules confirmed that their functions were behaving as intended.

\subsubsection{Welcome Screen}\label{Testing:WelcomeScreen}
The push buttons were tested to check if they led to the appropriate GUI elements and called the correct functions. 

In the Welcome window, the register and login buttons were pressed, and they lead to the register and login screens respectively. 

In the register screen, the back button led the user back to the welcome screen. The text fields allowed user input up to 15 characters with the password field being masked with bullet points. The submit button saved the new user in the credentials file and sent the user to the DCM main window when there were less than 10 users registered. The submit button displayed a popup message telling the user that the maximum of 10 registered users had been reached when there were 10 users registered. The submit button displayed a popup message telling the user to login instead if the username already exists in the credentials file.

In the login screen, the back button led the user back to the welcome screen. The text fields allowed user input up to 15 characters with the password field being masked with bullet points. The submit button sent the user to the DCM main window when the user's credentials were present in the credentials file. The submit button displayed a popup message instructing the user to register the account if the user did not exist in the credentials file. The submit button displayed a popup message telling the user that the password is incorrect if the username existed in the credentials file but the passwords did not match.

\subsubsection{DCM Main Window}\label{Testing:DCMMainWindow}
The push buttons, check boxes, graphs and radio buttons were tested to see if they led to the appropriate GUI elements and called the correct functions.

The pace electrograms were no longer displayed when the pace leads checkbox was unchecked. The pace electrograms were displayed again when the pace leads checkbox was checked. The sense electrograms were no longer displayed when the sense leads checkbox was unchecked. The sense electrograms were displayed again when the sense leads checkbox was checked. The electrogram graphs were scrollable.

The Reports window was opened when the reports button was pressed. The Parameters window was opened when the parameters button was pressed. The About window was opened when the about button was pressed. The Set Clock window was opened when the set clock window was pressed. The new patient button could not be tested in its current implementation as the testers only had access to one pacemaker. The program was exitted when the quit button was pressed.

\subsubsection{Reports}\label{Testing:Reports}
The push buttons were tested to check if they called the correct functions.

The "Electrogram" and "Temporary Parameters" buttons did not display anything. The "Bradycardia Parameters" button displayed a popup window showing the necessary header information. The pacing mode selected in the DCM main window and the relevant programmable parameters for the pacing mode were displayed following the header information. 

Other functions of the main window could not be accessed while the Reports window was active.

\subsubsection{Parameters}\label{Testing:Parameters}
The push buttons and the data table were tested to check if they called the correct functions and displayed the intended behaviour.

The only values displayed that could be changed were the ones listed under the "Values" column. All other text could not be modified. Changing the values in the column did not immediately update the parameters file. 

The parameters file was updated when the "Confirm changes" button was pressed with modified values in the table. 

The reset to defaults button displayed a popup window to confirm if you want to reset all values. The "No" option returned the user to the Parameters window with no changes to the paramaters file. The "Yes" option returned the user to the Parameters window with the values in the parameters file and the values showed in the table being set to their default values. 

Other functions of the main window could not be accessed while the Parameters window was active.

\subsubsection{About}
None of the cells in the table could be selected or modified.

Other functions of the main window could not be accessed while the About window was active.

\subsubsection{New Patient}
The New Patient functions could not be tested in its current implementation due the testers only having access to one pacemaker.

\subsection{Handlers}
The handlers were largely tested alongside the GUI as most handler functions are called from within the GUI. Tests for all modules confirmed that their functions were behaving as intended. 

\subsubsection{Authentication}
The authentication handler and its functions were tested in the register and login widgets in Section \ref{Testing:WelcomeScreen}. 

\subsubsection{Connection}
The status bar showed the message "Not connected to pacemaker" when the DCM main window was reached with no pacemaker connected. The status bar showed "Registered pacemaker 7" when a pacemaker was connected. When the pacemaker was disconnected, the status bar showed "Not connected to pacemaker 7". There was no testing done on functions that relied on an unregistered pacemaker to be connected, as the testing could only be done with a single pacemaker.

\subsubsection{Graphs}
The graphs handler and its functions were tested with the DCM main window electrograms in Section \ref{Testing:DCMMainWindow}

\subsubsection{Reports}
The reports handler and its functions were tested with the reports window in section \ref{Testing:Reports}.

\subsubsection{Parameters}
The parameters handler and its functions were tested in the parameters window in Section \ref{Testing:Parameters}.



\end{document}